---
title: "mNSC DEG and EA"
author: "Ryan Miller"
format: html
editor: source
---

# Libraries
```{r results: 'hide'}
# hides the chunk output
library("styler")
library("tidyverse")
library("rmarkdown")
```

Imports
Sample sheet from nextflow round 2 /data/project/MillerLab/projects/mNSC/250730_mNSC_nf-core

salmon gene counts
Original file locations
/data/project/MillerLab/projects/mNSC/250730_mNSC_nf-core/sf

genome
/data/project/MillerLab/genomes/GRCm39_vM37

Files copied into the *input* folder on July 30, 2025

# Sample metadata
```{r}
setwd("/data")
getwd()
# path to original metadata
samples_file <- "/data/input/samples.csv"

# import metadata csv
samples <- read.csv(samples_file, header = TRUE, sep = ",")
remove_rownames(samples) %>% has_rownames()

# samples column to rownames
rownames(samples) <- NULL
samples <- column_to_rownames(samples, var = c("sample"))
```

## sf files
```{r}
samples$files_sf <- paste0("./sf/", rownames(samples), ".sf")
files_sf <- samples$files_sf
all(file.exists(files_sf))
```

# Inputs
```{r}
#| label: "inputs"
#| echo: true
#| file: 01_inputs.R

# Source the external R script
source(file.path("./scripts/01_inputs.R")) 
```

## Project variables
```{r}
head(samples)
colnames(samples)
var1 <- "Host"
var2 <- "Driver"
var3 <- "Type"
var4 <- "Clone"
var5 <- "Replicate"
var6 <- "LibraryBatch"
var7 <- "SeqBatch"

project_genes <- c("Egfr", "Pdgfra", "Pten", "Cdkn2a")

anno <- as.data.frame(samples[,c(var1, var2, var3, var4)])
anno %>%
  group_by(Host, Driver, Type, Clone) %>%
  summarize(n=n())

# Get unique entries for each variable
unique_values_by_var <- lapply(anno, unique)
print(unique_values_by_var)

anno_colors <- list(
  Host = c("NSG" = 'gray', "BL6" = 'black'),
  Driver = c("EGFRvIII" = 'blue', "EGFRvV" = 'dodgerblue', "PDGFRA" = 'red'),
  Type = c("NS1" = 'gray80', "NS2" = 'gray50', "GBO" = 'black', "Tumor" = 'purple')
)
```

# DESeq objects
```{r}
#| label: "txi_dds_filt script"
#| echo: true

# Source the external R script
source(file.path("./scripts/02_txi_dds_filt.R")) 
```

# QC
```{r}
#| label: "QC script"
#| echo: true

# Source the external R script
source(file.path("./scripts/03_QC.R")) 
```

# DESeq2
```{r}
#| label: "DESeq2 script"
#| echo: true

# Source the external R script
source(file.path("./scripts/04_DESeq.R")) 
```

# Session
```{r}
sessionInfo()
```